#!/usr/bin/env zsh

if ! in-git-repo; then
  echo_err "Not in git repository."
  return 128
fi

if [[ "$1" == "" ]]; then
  echo-info -n "Getting remote HEAD... "
  GIT_HEAD="$(get_remote_head)"
  echo $GIT_HEAD

  echo-run git fetch --quiet && \
  echo-run git rebase origin/$GIT_HEAD
  return $?
fi

if [[ ("$1" == "-i" || "$1" == "--interactive") && "$#" -le 1 ]]; then
  echo-info -n "Getting remote HEAD... "
  GIT_HEAD="$(get_remote_head)"
  echo $GIT_HEAD

  echo-run git fetch --quiet && \
  echo-run git rebase --interactive origin/$GIT_HEAD
  return $?
fi

if [[ "$1" == "--continue" && "$#" -le 1 ]]; then
  echo-run git rebase --continue
  return $?
fi

if [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
  echo "Usage: $0 [<git rebase args>]"
  return
fi

echo-run git fetch --quiet && \
echo-run git rebase $@

# if needs_git_cleanup; then
#   git_cleanup
# fi
