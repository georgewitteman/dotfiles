{{- $work := (index . "is_work") -}}
{{- $transient := (index . "is_transient") -}}

{{- if and stdinIsATTY (not (env "CI")) (not (env "GITPOD_HOST")) -}}
{{- $work = promptBoolOnce . "is_work" "Is this a work computer (y/n)" -}}
{{- $transient = promptBoolOnce . "is_transient" "Is this a transient machine (y/n)" -}}
{{- end -}}

{{- $work_dict := default dict (index . "work") }}
{{- $work_email := index (default dict (index . "work")) "email" -}}
{{- $work_signingkey := index (default dict (index . "work")) "signingkey" -}}
{{- $work_path := index (default dict (index . "work")) "path" -}}
{{- $work_terms := index (default dict (index . "work")) "terms" -}}
{{- $work_github_org := index (default dict (index . "work")) "github_org" -}}

{{- if $work -}}
{{- $work_email = promptStringOnce $work_dict "email" "What is your work email" -}}
{{- $work_path = promptStringOnce $work_dict "path" "Where are your work repositories located" -}}
{{- $work_signingkey = promptStringOnce $work_dict "signingkey" "What is your work PGP key fingerprint" -}}
{{- $work_github_org = promptStringOnce $work_dict "github_org" "What is your work GitHub organization name" -}}
{{- end -}}

sourceDir: {{ .chezmoi.sourceDir | quote }}

data:
  is_work: {{ kindIs "bool" $work | ternary $work false }}
  is_transient: {{ kindIs "bool" $transient | ternary $transient false }}
  name: "George Witteman"
  email: "george@witteman.me"
  gpgkey: "3F31B900236A9F918F143AE106223EC3AE0381FB"
{{- if $work }}
  work:
    terms:
      {{- range $work_terms }}
      - {{ . | quote }}
      {{- end }}
    signingkey: {{ $work_signingkey | quote }}
    email: {{ $work_email | quote }}
    path: {{ $work_path | expandenv | osClean | quote }}
    github_org: {{ $work_github_org | quote }}
    {{- if $work_github_org }}
    git_includeif: "hasconfig:remote.*.url:git@github.com:{{ $work_github_org }}/**"
    {{- end }}
{{- end }}
