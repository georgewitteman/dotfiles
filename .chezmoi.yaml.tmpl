{{- $work := (index . "is_work") -}}
{{- $transient := (index . "is_transient") -}}

{{- if and stdinIsATTY (not (env "CI")) (not (env "GITPOD_HOST")) -}}
{{- $work = promptBoolOnce . "is_work" "Is this a work computer (y/n)" -}}
{{- $transient = promptBoolOnce . "is_transient" "Is this a transient machine (y/n)" -}}
{{- end -}}

{{- $work_dict := default dict (index . "work") }}
{{- $work_email := index (default dict (index . "work")) "email" -}}
{{- $work_path := index (default dict (index . "work")) "path" -}}
{{- $work_terms := index (default dict (index . "work")) "terms" -}}
{{- $work_ssh_config := index (default dict (index . "work")) "ssh_config" -}}
{{- $work_git_includeif := index (default dict (index . "work")) "git_includeif" -}}

{{- if $work -}}
{{- $work_email = promptStringOnce $work_dict "email" "What is your work email" -}}
{{- $work_path = promptStringOnce $work_dict "path" "Where are your work repositories located" -}}
{{- $work_ssh_config = promptStringOnce $work_dict "ssh_config" "What is the relative path for the ssh config" -}}
{{- $work_git_includeif = promptStringOnce $work_dict "git_includeif" "What is the includeIf for work repositories" -}}
{{- end -}}

sourceDir: {{ .chezmoi.sourceDir | quote }}

data:
  is_work: {{ kindIs "bool" $work | ternary $work false }}
  is_transient: {{ kindIs "bool" $transient | ternary $transient false }}
  name: "George Witteman"
  email: "george@witteman.me"
  gpgkey: "3F31B900236A9F918F143AE106223EC3AE0381FB"
{{- if $work }}
  work:
    terms:
      {{- range $work_terms }}
      - {{ . | quote }}
      {{- end }}
    signingkey: "3F7D97CD2491D6CD2B814EF36F1B35AC1C424C4F"
    email: {{ $work_email | quote }}
    path: {{ $work_path | expandenv | osClean | quote }}
    ssh_config: {{ $work_ssh_config | expandenv | osClean | quote }}
    git_includeif: {{ $work_git_includeif | quote }}
{{- end }}
