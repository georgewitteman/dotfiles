#!/bin/sh

set -e
set -x

if command -v op >/dev/null 2>&1; then
  exit
fi

{{- if eq.chezmoi.os "darwin" -}}
brew install --cask 1password-cli
{{- else -}}
tmpdir="$(mktemp -d)"
cd "$tmpdir"

VERSION="1.9.2"
curl "https://cache.agilebits.com/dist/1P/op/pkg/v${VERISION}/op_linux_amd64_v${VERSION}.zip" \
  -o "op_linux_amd64_v${VERSION}.zip"
gpg --receive-keys 3FEF9748469ADBE15DA7CA80AC2D62742012EA22
gpg --verify op.sig op
mv op /usr/local/bin
op --version
{{ end -}}

set +x
