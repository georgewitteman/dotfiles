#!/usr/bin/env bash

if [[ -z $ENV ]]; then
  # If ~/.bash_profile wasn't sourced then source it
  # shellcheck source=.bash_profile
  source "${HOME}/.bash_profile"
  return $?
fi

# shellcheck source=.shinit
source "${HOME}/.shinit"

if command -v "gh" &>/dev/null; then
  eval "$(gh completion --shell bash || true)"
fi

# https://docs.brew.sh/Shell-Completion
if [[ -r "${HOMEBREW_PREFIX}/etc/profile.d/bash_completion.sh" ]]; then
  # shellcheck source=/dev/null
  source "${HOMEBREW_PREFIX}/etc/profile.d/bash_completion.sh"
elif [[ -d "${HOMEBREW_PREFIX}/etc/bash_completion.d" ]]; then
  for COMPLETION in "${HOMEBREW_PREFIX}/etc/bash_completion.d/"*; do
    if [[ -r ${COMPLETION} ]]; then
      # shellcheck source=/dev/null
      source "${COMPLETION}"
    fi
  done
  unset COMPLETION
fi

# https://github.com/nvm-sh/nvm#manual-install
# shellcheck disable=SC1091,SC2292
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
# shellcheck disable=SC1091,SC2292
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

{{ template "terraform-completion.bash" }}
{{ template "prompt/init.bash" }}
# Keep this at the end
if [[ -e "${HOME}/.cache/iterm2/iterm2_shell_integration.bash" ]]; then
  # shellcheck source=/dev/null
  source "${HOME}/.cache/iterm2/iterm2_shell_integration.bash" || true
fi
